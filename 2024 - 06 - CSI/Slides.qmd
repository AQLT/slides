---
title: |
 | Estimation en temps réel de la tendance-cycle :
 | Apport de l'utilisation des filtres asymétriques dans la détection des points de retournement
subtitle: "CSI"
author: "Alain Quartier-la-Tente"
departement: "10 juin 2024"
format:
  beamer:
    template: template.tex
    slide-level: 3
    theme: TorinoTh
    keep-tex: false
    pdf-engine: pdflatex
    include-in-header: preamble_beamer.tex
fontsize: 10pt
classoption: 'usepdftitle=false,french' # handout
themeoptions: "coding=utf8,language=french"
logo: "img/logobeamer"
freeze: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      cache = F,
                      fig.align = 'center',
                      fig.path = "img/rmd-")
library(knitr)
library(kableExtra)
library(rjd3filters)
gen_MM <- function(p=6, q=p, d=2, reg = NULL){
  X_gen <- function(d = 1, p = 6, q = p){
    sapply(0:d, function(exp) seq(-p, q)^exp)
  }
  k = rjd3filters::get_kernel("Henderson", h = p)
  k = c(rev(k$coef[-1]), k$coef[seq(0,q)+1])
  K = diag(k)
  X = cbind(X_gen(d=d, p = p, q = q), reg)
  e1 = matrix(0, ncol = 1, nrow = ncol(X))
  e1[1] = 1
  # Estimator of the constant
  M1 = K %*% X %*% solve(t(X) %*% K %*% X, e1)
  moving_average(M1, lags = -p)
}
fig.ext <- "pdf"
# load(file = "tables.RData")
# mae <- readRDS("tables_revisions.RDS")$MAE
```

# Introduction

### Retour sur le passé

Dernier CSI : 08 novembre 2023

- Travaux sur l'estimation en temps-réel de la tendance-cycle

. . .

- Document de travail Insee en cours avec code ouvert et entièrement reproductible maintenant publié

. . .

- Une soumission en cours au Journal of Official Statistics (JOS) sur la paramétrisation locale des filtres asymétriques\
Retour des référés en février et réponse donnée fin avril

. . .

- Idée de faire une soumission d'un article "informatique" au JSS (compliqué au R Journal)

- Objectif : soutenir en début année scolaire 2025-2026

### CSI de novembre

- Essayer d'implémenter les tests sur la comparaison des modèles et d'étendre aux tests de comparaison multiple  
\faIcon{arrow-circle-right} Non effectué

. . .

- Travaux sur les points atypiques à partir de méthodes robustes  
\faIcon{arrow-circle-right} Débuté

. . .

- La desaisonnalisation haute fréquence sera creusée en fin de thèse en fonction du temps restant  
\faIcon{arrow-circle-right} Non effectué mais Bundesbank commencent des travaux sur la longueur des moyennes mobiles avec `rjd3filters`


# Réponse aux référés

### Réponses aux référés

- Ajout de simulations en utilisation la méthode des plus proches voisins (toujours 13 termes)

. . .

- Ajout de simulations sur des données trimestrielles (pas de différences car fenêtre trop petite) et d'une marche à suivre pour les données haute fréquence

. . .

- Ajout d'une section sur le COVID-19 et l'impact des points atypiques

# Début étude sur les points atypiques

### Ajout de régresseurs (1)

Moyennes mobiles classiques peuvent être obtenues par analogie avec la régression polynomiale locale
$$
\forall j\in\left\llbracket -h,h\right\rrbracket : y_{t+j}=\underbrace{\sum_{i=0}^{d}\beta_{i}j^{i}}_{m_{t+j}}+\varepsilon_{t+j}
$$

Estimation en utilisant les WLS avec *noyaux*: $\hat{\beta}=(X'KX)^{1}X'Ky$ et
$$
\hat{m}_{t}=\hat\beta_0=w'y=\sum_{j=-h}^{h}w_{j}y_{t-j}
$$

. . .

Idée 1 : estimer le modèle 
$$
 y_{t+j}=\sum_{i=0}^{d}\beta_{i}j^{i} + \gamma x_{t+j}+\varepsilon_{t+j}
$$

### Ajout de régresseurs (2)

Exemple pour un AO en $t+i$ : $x_{t+j}=1$ si $j=i$  et $0$ sinon

. . .

C'est équivalent à imposer $w_j=0$ et à renormaliser les coefficients

Exemple pour $i=0$

```{r, fig.width=5, fig.height=3.5}
plot_coef(gen_MM(reg= c(rep(0,6), 1, rep(0, 6))), col = "orange", ylab = "")
plot_coef(gen_MM(), add = TRUE, col = "darkblue")
```

### Ajout de régresseurs (3)

Autre exemple pour un LS en $t+i$ : $x_{t+j}=1$ si $j\geq i$  et $0$ sinon

Ce n'est pas équivalent à ajouter plusieurs AO

Exemple pour $i=0$

```{r, fig.width=5, fig.height=3.5}
plot_coef(gen_MM(reg= c(rep(0,6), 1, rep(1, 6))), col = "orange", ylab = "")
plot_coef(gen_MM(), add = TRUE, col = "darkblue")
```

## Utilisation de méthodes robustes

### Méthodes testées de `robfilter` {.allowframebreaks}

$$
y_{t+i}=\mu_t+\beta_ti+\varepsilon_{t,i}\text{ et }
r_{t+i}=y_{t+i}-\hat\mu_t-\hat\beta_ti
$$

- Médiane mobile :

$$
\hat\mu_t=\underset{i=-m,\dots,m}{\med}y_{t+i}
$$

- Least Median of Squares regression (LMS)
$$
(\hat\mu_t,\beta_t)=\underset{\hat\mu_t,\beta_t}{\argmin}\left\{ \underset{i=-m,\dots,m}{\med}r^2_{t+i} \right\}
$$

- Least Trimmed Squares regression (LTS)
$$
(\hat\mu_t,\hat\beta_t)=\underset{\hat\mu_t,\beta_t}{\argmin}\left\{ \sum_{i=-m}^m r^2_{t+i} \right\}
$$

- Repeated Median regression (RM)
$$
\hat{\beta}_{t}=\underset{i=1,\dots,n}{\med}\left\{ \underset{i\ne j}{\med}\frac{y_{t+i}-y_{t+j}}{i-j} \right\}
$$
et 
$$
\hat\mu_t=\underset{i=1,\dots,n}{\med}\left\{ y_{t+i}-i\hat{\beta}_{t} \right\}
$$
- Least Quartile Difference regression (LQD)

- Deepest Regression (DR)

Autres méthodes non testées : pondérations, hybrides, loess, Hampel


### Données réelles (1)

![](img/obs_covid.pdf)


### Données réelles (2)

![](img/obs_2001.pdf)


### Données simulées (variabilité moyenne)

![](img/simul_med.pdf)

### Données simulées (variabilité faible)

![](img/simul_low.pdf)

### Données simulées (variabilité haute)

![](img/simul_high.pdf)


### Discussion


- un point de retournement est-il considéré comme un point atypique ?

. . .

- se concentrer sur des méthodes qui prennent en compte les outliers ou qui sont robustes à ces méthodes ? 
étude de méthodes robustes avec une tendance de degré 2 ?
Pondérer les observations ?
ou bien se concentrer sur des moyennes mobiles (en étudiant les estimations intermédiaires) ?

. . .

- étudier des séries simulées ? uniquement AO ou aussi LS ?


